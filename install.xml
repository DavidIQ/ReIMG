<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="./modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
	
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en-gb">ReIMG Image Resizer</title>
		
		<description lang="en-gb">Resizes user-posted images, including or excluding signatures, that are too large, optionally overlaying a zoom button to view the original-sized image (optionally in a lightbox or even using Highslide JS).</description>
		
		<author-notes lang="en-gb"><![CDATA[This MOD depends on client-side javascript support. However, it will not break without javascript, there will simply be less functionality (i.e. too large images will not be resized after all).
		
This MOD has been tested successfully with the following browsers:

* Internet Explorer 6, 7, 8
* Firefox 1.0, 1.5, 2, 3, 3.5
* Opera 9.27, 9.5, 9.6
* Safari 3.1, 4
* Mozilla 1.7
* Google Chrome 2.0.172.37
* Konqueror 4.2.2
* Epiphany 2.26.3

Since this MOD was not designed for any of these browsers specifically, any other W3C (semi-)compliant browser should also work.

This MOD uses HTML attributes (onload and onerror) that are not part of the XHTML 1.0 Strict and Transitional specifications. This is not a problem in virtually all popular browser software, but if you really need to stay 100% XHTML 1.0 compliant, then you could leave out the onload and onerror attributes. The drawback of this is that all images are shown at once, but only after the full document (including *all* images) has loaded. The user will probably experience this as being slower, because he will not see the images loading. One way of solving this is to show thumbnails of the images while loading them by adding this rule to your theme's style sheet:

.reimg { width: 10%; height: auto; visibility: visible; }

Included with this MOD are two versions of the reimg.js and litebox.js javascript files:

1. In root/reimg/ you will find the compressed versions, which are smaller in file size and will download more quickly. (For more information visit http://javascriptcompressor.com/.)
2. In contrib/js_original/ you will find the original javascript files with reasonably documented source code, which is more easily hackable/editable.

By default the compressed versions are installed to optimize for speed.

To change settings go to ACP -> Post Settings -> Image Resize Settings (at the bottom of the page).
Please note that if you plan on using Highslide JS you must follow the instructions shown next to the Zooming Method drop-down.]]></author-notes>
		
		<author-group>
			<author>
				<realname>David Colon</realname>
				<username>DavidIQ</username>
				<email>davidiq@phpbb.com</email>
				<homepage>http://www.davidiq.com/</homepage>
				<contributions-group>
					<contributions status="current" position="Current Developer"></contributions>
				</contributions-group>
			</author>
			<author>
				<realname>Theo Niessink</realname>
				<username>TaleTN</username>
				<email>theo@taletn.com</email>
				<homepage>http://www.taletn.com/</homepage>
				<contributions-group>
					<contributions status="past" position="Occasional Contributor"></contributions>
				</contributions-group>
			</author>
		</author-group>
		
		<mod-version>2.0.0</mod-version>
		
		<installation>
			<level>intermediate</level>
			<time>1200</time>
			<target-version>3.0.8</target-version>
		</installation>

		<history>
			<entry>
				<date>2011-03-27</date>
				<rev-version>2.0.0</rev-version>
				<changelog lang="en-gb">
					<change>New ReIMG version!</change>
				</changelog>
			</entry>
		</history>
		
		<link-group>
			<link type="template" lang="en-gb" href="subsilver2.xml">subsilver2 Edits</link>
		</link-group>
	</header>

	<action-group>

		<copy>
			<file from="root/install_reimg.php" to="install_reimg.php" />
			<file from="root/adm/*.*" to="adm/*.*" />
			<file from="root/includes/*.*" to="includes/*.*" />
			<file from="root/language/en/mods/*.*" to="language/en/mods/*.*" />
			<file from="root/reimg/*.*" to="reimg/*.*" />
			<file from="root/styles/prosilver/*.*" to="styles/prosilver/*.*" />
			<file from="root/umil/*.*" to="umil/*.*" />
		</copy>
		
		<open src="memberlist.php">
			<edit>
				<find><![CDATA[			'SIGNATURE'		=> $member['user_sig'],]]></find>
				<action type="replace-with"><![CDATA[			'SIGNATURE'		=> ($config['reimg_ignore_sig_img']) ? str_replace(reimg_properties(), '', $member['user_sig']) : $member['user_sig'],]]></action>
			</edit>
		</open>
		
		<open src="posting.php">
			<edit>
				<find><![CDATA[			'PREVIEW_SIGNATURE'		=> $preview_signature,]]></find>
				<action type="replace-with"><![CDATA[			'PREVIEW_SIGNATURE'		=> ($config['reimg_ignore_sig_img']) ? str_replace(reimg_properties(), '', $preview_signature) : $preview_signature,]]></action>
			</edit>
		</open>
		
		<open src="viewtopic.php">
			<edit>
				<find><![CDATA[		'SIGNATURE'			=> ($row['enable_sig']) ? $user_cache[$poster_id]['sig'] : '',]]></find>
				<action type="replace-with"><![CDATA[		'SIGNATURE'			=> ($row['enable_sig']) ? ($config['reimg_ignore_sig_img'] ? str_replace(reimg_properties(), '', $user_cache[$poster_id]['sig']) : $user_cache[$poster_id]['sig']) : '',]]></action>
			</edit>
		</open>
		
		<open src="includes/bbcode.php">
			<edit>
				<find><![CDATA[								'#\[img:$uid\](.*?)\[/img:$uid\]#s'		=> $this->bbcode_tpl('img', $bbcode_id),]]></find>
				<action type="replace-with"><![CDATA[								'#\[img:$uid\](.*?)\[/img:$uid\]#s'		=> str_replace('$2', reimg_properties(), $this->bbcode_tpl('img', $bbcode_id)),]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'img'		=> '<img src="$1" alt="' . $user->lang['IMAGE'] . '" />',]]></find>
				<inline-edit>
					<inline-find><![CDATA[/>]]></inline-find>
					<inline-action type="before-add"><![CDATA[' . reimg_properties() . ']]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find>			'img'					=> array('{URL}'		=> '$1'),</find>
				<action type="replace-with">			'img'					=> array('{URL}'		=> '$1', '{REIMG_PROPERTIES}'	=> '$2'),</action>
			</edit>
		</open>

		<open src="includes/functions_content.php">
			<edit>
				<find><![CDATA[			'attachment_tpl'	=> 'attachment.html')
		);
	}]]></find>
				<action type="after-add"><![CDATA[	$template->assign_vars(array(
		'S_REIMG'			=> ($config['reimg_max_width'] || $config['reimg_max_height'] || $config['reimg_rel_width']) ? 1 : 0,
		'REIMG_PROPERTIES'	=> reimg_properties(),
	));]]></action>
			</edit>
		</open>

		<open src="includes/acp/acp_styles.php">
			<edit>
				<find>		$user->add_lang('acp/styles');</find>
				<action type="after-add">		$user->add_lang('mods/reimg');</action>
			</edit>
			<edit>
				<find><![CDATA['icon_back_top', ]]></find>
				<action type="after-add"><![CDATA[				'icon_reimg_loading', 'icon_reimg_zoom_in', 'icon_reimg_zoom_out',]]></action>
			</edit>
		</open>
		
		<open src="includes/ucp/ucp_pm_viewmessage.php">
			<edit>
				<find><![CDATA[		'SIGNATURE'			=> ($message_row['enable_sig']) ? $signature : '',]]></find>
				<action type="replace-with"><![CDATA[		'SIGNATURE'			=> ($message_row['enable_sig']) ? (($config['reimg_ignore_sig_img']) ? str_replace(reimg_properties(), '', $signature) : $signature) : '',]]></action>
			</edit>
		</open>
		
		<open src="includes/ucp/ucp_profile.php">
			<edit>
				<find><![CDATA[					'SIGNATURE_PREVIEW'	=> $signature_preview,]]></find>
				<action type="replace-with"><![CDATA[					'SIGNATURE_PREVIEW'	=> ($config['reimg_ignore_sig_img']) ? str_replace(reimg_properties(), '', $signature_preview) : $signature_preview,]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/imageset/imageset.cfg">
			<edit>
				<find>img_icon_user_warn =</find>
				<action type="after-add"><![CDATA[
img_icon_reimg_loading = icon_reimg_loading.gif*16*16
img_icon_reimg_zoom_in = icon_reimg_zoom_in.gif*20*20
img_icon_reimg_zoom_out = icon_reimg_zoom_out.gif*20*20]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/attachment.html">
			<edit>
				<find><![CDATA[			<dt class="attach-image"><img src="{_file.U_INLINE_LINK}" alt="{_file.DOWNLOAD_NAME}" onclick="viewableArea(this);" /></dt>]]></find>
				<inline-edit>
					<inline-find>class="attach-image"</inline-find>
					<inline-action type="after-add"><![CDATA[<!-- IF S_REIMG --> style="overflow: hidden; max-height: none;"<!-- ENDIF -->]]></inline-action>
				</inline-edit>
				<inline-edit>
					<inline-find>onclick="viewableArea(this);"</inline-find>
					<inline-action type="replace-with"><![CDATA[<!-- IF S_REIMG -->style="border: none;" {REIMG_PROPERTIES}<!-- ELSE -->onclick="viewableArea(this);"<!-- ENDIF -->]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/prosilver/template/bbcode.html">
			<edit>
				<find><![CDATA[<!-- BEGIN img --><img src="{URL}" alt="{L_IMAGE}" /><!-- END img -->]]></find>
				<inline-edit>
					<inline-find><![CDATA[/>]]></inline-find>
					<inline-action type="before-add"><![CDATA[{REIMG_PROPERTIES}]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		
		<open src="styles/prosilver/template/overall_footer.html">
			<edit>
				<find><![CDATA[</body>]]></find>
				<action type="before-add"><![CDATA[<!-- IF S_REIMG -->
	<script type="text/javascript">
		if (window.reimg_version)
		{
			reimg_loading("{REIMG_LOADING_IMG_SRC}");
		}
	</script>
<!-- ENDIF -->
]]></action>
			</edit>
		</open>
		
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[<link href="{T_THEME_PATH}/print.css" rel="stylesheet" type="text/css" media="print" title="printonly" />]]></find>
				<action type="before-add"><![CDATA[<!-- INCLUDE reimg_content.html -->]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/ucp_pm_viewmessage.html">
			<edit>
				<find><![CDATA[		<dl class="attachbox">]]></find>
				<inline-edit>
					<inline-find><![CDATA[>]]></inline-find>
					<inline-action type="before-add"><![CDATA[ style="width: 97%;"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/prosilver/template/ucp_pm_viewmessage_print.html">
			<edit>
				<find><![CDATA[<style type="text/css">]]></find>
				<action type="before-add"><![CDATA[<!-- INCLUDE reimg_content.html -->]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<find><![CDATA[				<dl class="attachbox">]]></find>
				<inline-edit>
					<inline-find><![CDATA[>]]></inline-find>
					<inline-action type="before-add"><![CDATA[ style="width: 97%;"]]></inline-action>
				</inline-edit>
			</edit>
		</open>

		<open src="styles/prosilver/template/viewtopic_print.html">
			<edit>
				<find><![CDATA[<link href="{T_THEME_PATH}/print.css" rel="stylesheet" type="text/css" />]]></find>
				<action type="before-add"><![CDATA[<!-- INCLUDE reimg_content.html -->]]></action>
			</edit>
		</open>

		<php-installer>install_reimg.php</php-installer>

		<diy-instructions lang="en-gb">Remember to refresh your template and imageset and purge the cache.</diy-instructions>

	</action-group>
</mod>
